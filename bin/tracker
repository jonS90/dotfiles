#! /usr/bin/env bash

# echo hi $1
arg="$1"
if [[ -z "$1" ]]; then
  arg=HEAD
fi
if [[ "$1" =~ ^#?[0-9]{8}$ ]]; then
  echo specifiyng tracker id directly is not implemented
  exit 1
else
  commit_sha=$(git rev-parse $arg)
  if [[ $? ]]; then
    echo "error getting commit sha"
    exit 1
  fi
  story_id=$(git show "$commit_sha" | grep -e '#[[:digit:]]\{9\}' --only-matching)
  if [[ -z "$story_id" ]]; then
    echo "Story id not found in commit $commit_sha"
    exit 1
  fi
fi

if [[ $(command -v open) ]]; then
  open_cmd=open
else
  open_cmd=xdg-open
fi

echo "TODO: open browser to https://www.pivotaltracker.com/n/projects/\$PIVOTAL_TRACKER_PROJECT/stories/$story_id"
echo $open_cmd
# $open_cmd "https://www.pivotaltracker.com/n/projects/$PIVOTAL_TRACKER_PROJECT/stories/$story_id"
